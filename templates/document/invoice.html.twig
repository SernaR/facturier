{% extends 'base.html.twig' %}

{% block page %}
	<h1>
    	Facture n°
    	{{ facture.numero }}
    	-
    	{{ facture.devis.client.nom }}
    	{{ facture.devis.client.prenom }}
    </h1>
{% endblock %}

{% block body %}
	<div class="col-lg-12 col-md-12 mb-3">
		<div class="card card-default card-table mt-3">
			<section>
				<table id="fact">
					<thead>
						<th class="ref">Référence</th>
						<th class="preta">Prestation</th>
						<th class="descrp">Description</th>
						<th class="pu">PU HT</th>
						<th class="qte">Quantité</th>
						<th class="montant">Montant HT</th>
					</thead>
					<tr>
						{% set somme = 0 %}
						{% for ligne in facture.ligneFacture %}
						<td class="ref2">{{ ligne.prestation.code }}</td>
						<td class="presta">{{ ligne.prestation.libelle }}</td>
						<td class="descrp">{{ ligne.prestation.description | nl2br}}</td>
						<td class="pu">{{ ligne.prestation.montant|number_format(2, '.', ' ') }} €</td>
						<td class="qte">{{ ligne.quantite }}</td>
						<td class="montant">{{ (ligne.prestation.montant*ligne.quantite)|number_format(2, '.', ' ') }} €</td>
					</tr>
					{% set somme = somme + (ligne.prestation.montant*ligne.quantite) %}
					{% endfor %}
				</table>
			</section>
			<footer>
				<table id="total">
					<tr>
						<td colspan="2" class="total-1" id="rglmt">
							Livraison de la prestation:
						</td>
						<td class="total-2">{{ facture.livraison | date("d/m/Y") }}</td>
						<td class="total-4"></td>
						<td class="total-5-bord">Total HT</td>
						<td class="total-6-bord">{{ somme|number_format(2, '.', ' ') }} €</td>
					</tr>
					<tr>
						<td colspan="3" rowspan="2" class="total-1-mention">
							Date: {{ facture.date  | date("d/m/Y") }}<br>
							{% if facture.devis.envoi %}
								<p>Selon devis n°{{ facture.devis.id }}</p>
							{% endif %}
						</td>
						<td class="total-4"></td>
						<td class="total-5-bord">Remise</td>
						<td class="total-6-bord">{{ facture.devis.discount }} %</td>
					</tr>
					<tr>
						<td class="total-4"></td>
						<td class="total-5-bord">Total TTC</td>
						{% set somme = somme - (somme*facture.devis.discount/100) %}
						<td class="total-6-bord">{{ somme|number_format(2, '.', ' ') }} €</td>
					</tr>
					<tr>
						<td colspan="3" rowspan="3" class="total-1-mention">
						</td>
						<td class="total-4"></td>
						<td class="total-5-bord">Acompte</td>
							{% set acompte = 0 %}
							{% if facture.devis and facture.devis.accompte %}
								{% set acompte = facture.devis.accompte.montant %}
							{% elseif facture.acompte %}	
								{% set acompte = facture.acompte %}
							{% endif %}
						<td class="total-6-bord">{{ acompte|number_format(2, '.', ' ') }} €</td>
					</tr>
					<tr>
						<td class="total-4"></td>
						<td class="total-5-bord">Restant à régler</td>
						{% set somme = somme - acompte %}
						<td class="total-6-bord">{{ somme|number_format(2, '.', ' ') }} €</td>
					</tr>
					<tr>
						<td class="total-4"></td>
						<td colspan="2" class="total-5" id="tva">{{ facture.devis.client.zone.texteTva }}</td>
					</tr>
					<tr>
						<td class="total-1"></td>
						<td class="total-2"></td>
						<td class="total-3"></td>
						<td class="total-4"></td>
						<td class="total-5">
							<a href="{{ path('research_customers', { name: facture.devis.client.nom }) }}" class="btn btn-primary btn-block btn-sm">Retour</a>
						</td>
						<td class="total-6"><div id="react_invoice_btn" data-invoice="{{ json }}"></div></td>
					</tr>
				</table>	
			</footer>
		</div>
	</div>	
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" type="text/css" href="{{ asset('css/render_PDF.css') }}">
{% endblock %}
